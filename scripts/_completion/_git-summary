#compdef git-summary

_git-summary() {
  emulate -L zsh -o extendedglob

  local context='' state='' state_descr=''
  local -a line=()
  typeset -A opt_args=()

  local -i orig_current="$CURRENT"
  local -a orig_words=("${words[@]}")

  local -a subcommands=()
  subcommands=(
    'today:Show today git summary'
    'yesterday:Show yesterday git summary'
    'this-month:Show this month summary'
    'last-month:Show summary for last month'
    'this-week:Show summary for this week (Mon–Sun)'
    'last-week:Show summary for last week (Mon–Sun)'
    'all:Show summary for entire git history'
    'help:Display help message for git-summary'
  )

  _arguments -C \
    '1:command:->subcmds' \
    '*::arg:->args'

  case "${state-}" in
    subcmds)
      _describe -t commands 'git-summary command' subcommands && return 0
      ;;
    args)
      local subcmd="${line[1]:-${orig_words[2]-}}"
      subcmd="${subcmd%%[[:space:]]#}"

      case "$subcmd" in
        today|yesterday|this-month|last-month|this-week|last-week|all|help)
          _message 'no additional arguments'
          return 0
          ;;
        *)
          if (( orig_current == 2 )); then
            _message 'start date (YYYY-MM-DD)'
          elif (( orig_current == 3 )); then
            _message 'end date (YYYY-MM-DD)'
          else
            _message 'git-summary <start> <end>'
          fi
          return 0
          ;;
      esac
      ;;
  esac
}

compdef _git-summary git-summary

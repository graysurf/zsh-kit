#compdef codex-tools
#
# Feature-gated: loaded only when `ZSH_FEATURES` includes `codex`.

_codex-tools() {
  emulate -L zsh -o extendedglob

  local context state state_descr
  local -a line
  typeset -A opt_args

  typeset -a subcmds
  subcmds=(
    'commit-with-scope:Run semantic-commit skill (with git-scope context)'
    'auto-refresh:Run codex-auto-refresh (token refresh helper)'
    'rate-limits:Run codex-rate-limits (wham/usage)'
    'create-feature-pr:Run create-feature-pr skill'
    'find-and-fix-bugs:Run find-and-fix-bugs skill'
    'release-workflow:Run release-workflow skill'
    'help:Show usage'
  )

  _arguments -C \
    '(-h --help)'{-h,--help}'[Show help]' \
    '1:command:->subcmds' \
    '*::arg:->args'

  case "${state-}" in
    subcmds)
      _describe -t commands 'codex-tools command' subcmds && return 0
      ;;
    args)
      local subcmd="${line[1]-${words[2]-}}"
      subcmd="${subcmd%%[[:space:]]#}"
      case "$subcmd" in
        commit-with-scope|create-feature-pr|find-and-fix-bugs|release-workflow)
          _message 'prompt text'
          return 0
          ;;
        auto-refresh)
          _message 'no args'
          return 0
          ;;
        rate-limits)
          _message 'args passed to codex-rate-limits'
          return 0
          ;;
      esac
      ;;
  esac
}

compdef _codex-tools codex-tools cx
